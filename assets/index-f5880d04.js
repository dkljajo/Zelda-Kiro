(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))h(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&h(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function h(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();class y{constructor(e,t){this.canvas=e,this.ctx=t,this.width=e.width,this.height=e.height,this.currentLevel=1,this.maxLevel=5,this.levelObjectives={1:{enemies:3,rupees:5,description:"Defeat 3 enemies and collect 5 rupees"},2:{enemies:5,rupees:8,description:"Defeat 5 enemies and collect 8 rupees"},3:{enemies:7,rupees:12,description:"Defeat 7 enemies and collect 12 rupees"},4:{enemies:10,rupees:15,description:"Defeat 10 enemies and collect 15 rupees"},5:{enemies:15,rupees:20,description:"Final Boss Level - Defeat all enemies!"}},this.gameState="playing",this.enemiesDefeated=0,this.rupeesCollected=0,this.player={x:256,y:224,width:16,height:16,speed:120,direction:"down",health:6,maxHealth:6,rupees:0,isMoving:!1,animFrame:0,animTimer:0,isAttacking:!1,attackTimer:0,attackDuration:.3,attackCooldown:0,invulnerable:!1,invulnerabilityTimer:0},this.camera={x:0,y:0},this.keys={},this.entities=[],this.world=this.generateWorld(),this.setupInput(),this.generateLevel(),console.log(`Level ${this.currentLevel} started!`),console.log(`Objective: ${this.levelObjectives[this.currentLevel].description}`)}setupInput(){document.addEventListener("keydown",e=>{this.keys[e.code]=!0,this.keys[e.key.toLowerCase()]=!0,(e.key.toLowerCase()==="z"||e.code==="KeyZ")&&console.log("Z key pressed for combat! Key:",e.key,"Code:",e.code),e.preventDefault()}),document.addEventListener("keyup",e=>{this.keys[e.code]=!1,this.keys[e.key.toLowerCase()]=!1,e.preventDefault()})}generateWorld(){const e=[];for(let i=0;i<11;i++){e[i]=[];for(let s=0;s<16;s++)s===0||s===16-1||i===0||i===11-1||Math.random()<.08?e[i][s]=1:e[i][s]=0}for(let i=4;i<7;i++)for(let s=6;s<10;s++)e[i][s]=0;return e[0][8]=0,e[11-1][8]=0,e[5][0]=0,e[5][16-1]=0,e}generateLevel(){this.entities=[];const e=this.levelObjectives[this.currentLevel],t=e.enemies;for(let s=0;s<t;s++){let l,r;do l=Math.floor(Math.random()*12)+2,r=Math.floor(Math.random()*7)+2;while(this.world[r][l]!==0||l>=6&&l<=9&&r>=4&&r<=6);const a=this.currentLevel>=3?Math.random()<.5?"octorok":"moblin":"octorok";this.entities.push({type:a,x:l*32,y:r*32,health:a==="moblin"?2:1,maxHealth:a==="moblin"?2:1,direction:Math.floor(Math.random()*4),moveTimer:0,speed:a==="moblin"?40:60,attackTimer:0,chaseRange:80,isChasing:!1})}const h=e.rupees;for(let s=0;s<h;s++){let l,r;do l=Math.floor(Math.random()*14)+1,r=Math.floor(Math.random()*9)+1;while(this.world[r][l]!==0);this.entities.push({type:"rupee",x:l*32+16,y:r*32+16,collected:!1,animTimer:Math.random()*Math.PI*2})}const i=Math.max(1,Math.floor(this.currentLevel/2));for(let s=0;s<i;s++){let l,r;do l=Math.floor(Math.random()*14)+1,r=Math.floor(Math.random()*9)+1;while(this.world[r][l]!==0);this.entities.push({type:"heart",x:l*32+16,y:r*32+16,collected:!1,animTimer:0})}}update(e){if(this.gameState==="gameOver"){(this.keys.r||this.keys.KeyR)&&this.restart();return}if(this.gameState==="levelComplete"){(this.keys[" "]||this.keys.Space)&&this.nextLevel();return}if(this.gameState==="gameWon"){(this.keys.r||this.keys.KeyR)&&this.restart();return}this.updatePlayer(e),this.updateEntities(e),this.updateCamera(),this.checkCollisions(),this.checkLevelComplete(),this.player.health<=0&&(this.gameState="gameOver")}updatePlayer(e){this.player.attackCooldown>0&&(this.player.attackCooldown-=e),this.player.isAttacking&&(this.player.attackTimer+=e,this.player.attackTimer>=this.player.attackDuration&&(this.player.isAttacking=!1,this.player.attackTimer=0)),this.player.invulnerable&&(this.player.invulnerabilityTimer+=e,this.player.invulnerabilityTimer>=1&&(this.player.invulnerable=!1,this.player.invulnerabilityTimer=0)),(this.keys.z||this.keys.KeyZ)&&!this.player.isAttacking&&this.player.attackCooldown<=0&&(this.player.isAttacking=!0,this.player.attackTimer=0,this.player.attackCooldown=.5,console.log("Attack initiated!"));let t=0,h=0;this.player.isMoving=!1,this.keys.ArrowUp?(h=-this.player.speed*e,this.player.direction="up",this.player.isMoving=!0):this.keys.ArrowDown&&(h=this.player.speed*e,this.player.direction="down",this.player.isMoving=!0),this.keys.ArrowLeft?(t=-this.player.speed*e,this.player.direction="left",this.player.isMoving=!0):this.keys.ArrowRight&&(t=this.player.speed*e,this.player.direction="right",this.player.isMoving=!0);const i=this.player.x+t,s=this.player.y+h;this.checkWallCollision(i,this.player.y)||(this.player.x=i),this.checkWallCollision(this.player.x,s)||(this.player.y=s),this.player.isMoving?(this.player.animTimer+=e,this.player.animTimer>=.15&&(this.player.animFrame=(this.player.animFrame+1)%2,this.player.animTimer=0)):this.player.animFrame=0}checkWallCollision(e,t){const i=Math.floor(e/32),s=Math.floor((e+this.player.width)/32),l=Math.floor(t/32),r=Math.floor((t+this.player.height)/32);for(let a=l;a<=r;a++)for(let o=i;o<=s;o++)if(a<0||a>=11||o<0||o>=16||this.world[a][o]===1)return!0;return!1}updateEntities(e){this.entities.forEach(t=>{if(t.type==="rupee"||t.type==="heart")t.animTimer+=e*3;else if((t.type==="octorok"||t.type==="moblin")&&t.health>0){const h=this.player.x-t.x,i=this.player.y-t.y;Math.sqrt(h*h+i*i)<t.chaseRange?(t.isChasing=!0,Math.abs(h)>Math.abs(i)?t.direction=h>0?1:3:t.direction=i>0?2:0):(t.isChasing=!1,t.moveTimer+=e,t.moveTimer>=1.5&&(t.direction=Math.floor(Math.random()*4),t.moveTimer=0));const l=t.isChasing?t.speed*1.5:t.speed,r=[0,1,0,-1][t.direction]*l*e,a=[-1,0,1,0][t.direction]*l*e,o=t.x+r,x=t.y+a,f=Math.floor(o/32),p=Math.floor(x/32);f>=0&&f<16&&p>=0&&p<11&&this.world[p][f]===0?(t.x=o,t.y=x):t.isChasing&&(t.direction=(t.direction+1)%4)}})}updateCamera(){this.camera.x=this.player.x-this.width/2,this.camera.y=this.player.y-this.height/2,this.camera.x=Math.max(0,Math.min(this.camera.x,16*32-this.width)),this.camera.y=Math.max(0,Math.min(this.camera.y,11*32-this.height))}checkCollisions(){this.entities.forEach(e=>{if(e.collected||e.health!==void 0&&e.health<=0)return;const t=this.player.x+this.player.width/2,h=this.player.y+this.player.height/2,i=e.x,s=e.y,l=t-i,r=h-s,a=Math.sqrt(l*l+r*r);let o=20;(e.type==="rupee"||e.type==="heart")&&(o=30),e.type==="rupee"&&a<40&&console.log(`Near rupee - Distance: ${a.toFixed(1)}, Threshold: ${o}, Player: (${t.toFixed(1)}, ${h.toFixed(1)}), Rupee: (${i.toFixed(1)}, ${s.toFixed(1)})`),a<o&&(e.type==="rupee"?(this.player.rupees++,this.rupeesCollected++,e.collected=!0,console.log(`âœ… RUPEE COLLECTED! Progress: ${this.rupeesCollected}/${this.levelObjectives[this.currentLevel].rupees}`),console.log(`Final distance was: ${a.toFixed(1)}`)):e.type==="heart"?this.player.health<this.player.maxHealth&&(this.player.health++,e.collected=!0,console.log("â¤ï¸ Health restored!")):(e.type==="octorok"||e.type==="moblin")&&(this.player.isAttacking?(e.health--,e.health<=0&&(this.enemiesDefeated++,console.log(`âš”ï¸ Enemy defeated! Progress: ${this.enemiesDefeated}/${this.levelObjectives[this.currentLevel].enemies}`),this.entities.push({type:"rupee",x:e.x,y:e.y,collected:!1,animTimer:0}))):this.player.invulnerable||(this.player.health--,this.player.invulnerable=!0,this.player.invulnerabilityTimer=0,console.log(`ðŸ’” Player hit! Health: ${this.player.health}`),this.player.health===0&&console.log("ðŸ’€ Game Over!"))))}),this.entities=this.entities.filter(e=>!e.collected&&(e.health===void 0||e.health>0))}checkLevelComplete(){const e=this.levelObjectives[this.currentLevel];this.enemiesDefeated>=e.enemies&&this.rupeesCollected>=e.rupees&&(this.gameState="levelComplete",console.log(`Level ${this.currentLevel} completed!`))}nextLevel(){if(this.currentLevel>=this.maxLevel){this.gameState="gameWon",console.log("Game completed! You won!");return}this.currentLevel++,this.enemiesDefeated=0,this.rupeesCollected=0,this.gameState="playing",this.player.health=Math.min(this.player.maxHealth,this.player.health+2),this.player.x=256,this.player.y=224,this.world=this.generateWorld(),this.generateLevel(),console.log(`Level ${this.currentLevel} started!`),console.log(`Objective: ${this.levelObjectives[this.currentLevel].description}`)}render(){if(this.ctx.fillStyle="#1a4a1a",this.ctx.fillRect(0,0,this.width,this.height),this.gameState==="gameOver"){this.renderGameOver();return}if(this.gameState==="levelComplete"){this.renderLevelComplete();return}if(this.gameState==="gameWon"){this.renderGameWon();return}this.ctx.save(),this.ctx.translate(-this.camera.x,-this.camera.y),this.renderWorld(),this.renderEntities(),this.renderPlayer(),this.ctx.restore(),this.renderUI()}renderWorld(){for(let t=0;t<11;t++)for(let h=0;h<16;h++){const i=h*32,s=t*32;if(this.world[t][h]===0){this.ctx.fillStyle="#228B22",this.ctx.fillRect(i,s,32,32),this.ctx.fillStyle="#32CD32";for(let l=0;l<8;l++){const r=i+l%4*8+(h+t+l)%4,a=s+Math.floor(l/4)*16+(h*t+l)%4;this.ctx.fillRect(r,a,2,2)}}else this.ctx.fillStyle="#8B4513",this.ctx.fillRect(i,s,32,32),this.ctx.fillStyle="#A0522D",this.ctx.fillRect(i+2,s+2,32-4,32-4),this.ctx.fillStyle="#654321",this.ctx.fillRect(i+4,s+4,32-8,32-8)}}renderEntities(){this.entities.forEach(e=>{if(!(e.collected||e.health<=0))if(e.type==="rupee"){const t=Math.sin(e.animTimer)*2;this.ctx.fillStyle="#00FF00",this.ctx.fillRect(e.x-6,e.y-8+t,12,16),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(e.x-2,e.y-4+t,4,8)}else if(e.type==="heart"){const t=Math.sin(e.animTimer)*1;this.ctx.fillStyle="#FF0000",this.ctx.fillRect(e.x-8,e.y-4+t,6,6),this.ctx.fillRect(e.x+2,e.y-4+t,6,6),this.ctx.fillRect(e.x-6,e.y+2+t,12,6),this.ctx.fillRect(e.x-4,e.y+8+t,8,4)}else e.type==="octorok"?(this.ctx.fillStyle=e.isChasing?"#FF6666":"#FF4444",this.ctx.fillRect(e.x,e.y,16,16),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(e.x+3,e.y+3,3,3),this.ctx.fillRect(e.x+10,e.y+3,3,3),this.ctx.fillStyle="#000000",this.ctx.fillRect(e.x+4,e.y+4,1,1),this.ctx.fillRect(e.x+11,e.y+4,1,1)):e.type==="moblin"&&(this.ctx.fillStyle=e.isChasing?"#6666FF":"#4444AA",this.ctx.fillRect(e.x,e.y,16,20),this.ctx.fillStyle="#6666CC",this.ctx.fillRect(e.x+2,e.y-4,12,8),this.ctx.fillStyle="#FFFFFF",this.ctx.fillRect(e.x+4,e.y-2,2,2),this.ctx.fillRect(e.x+10,e.y-2,2,2),this.ctx.fillStyle="#FF0000",this.ctx.fillRect(e.x+5,e.y-1,1,1),this.ctx.fillRect(e.x+11,e.y-1,1,1),e.health<e.maxHealth&&(this.ctx.fillStyle="#FF0000",this.ctx.fillRect(e.x,e.y-8,16,2),this.ctx.fillStyle="#00FF00",this.ctx.fillRect(e.x,e.y-8,e.health/e.maxHealth*16,2)))})}renderPlayer(){const e=this.player.invulnerable&&Math.floor(this.player.invulnerabilityTimer*10)%2?.5:1;if(this.ctx.save(),this.ctx.globalAlpha=e,this.ctx.fillStyle="#00AA00",this.ctx.fillRect(this.player.x+2,this.player.y+4,12,12),this.ctx.fillStyle="#FFDDAA",this.ctx.fillRect(this.player.x+4,this.player.y,8,6),this.ctx.fillStyle="#228B22",this.ctx.fillRect(this.player.x+3,this.player.y,10,4),this.ctx.fillStyle="#000",this.ctx.fillRect(this.player.x+5,this.player.y+2,1,1),this.ctx.fillRect(this.player.x+10,this.player.y+2,1,1),this.ctx.fillStyle="#8B4513",this.player.isMoving&&this.player.animFrame===1?(this.ctx.fillRect(this.player.x+3,this.player.y+12,3,4),this.ctx.fillRect(this.player.x+10,this.player.y+12,3,4)):(this.ctx.fillRect(this.player.x+4,this.player.y+12,3,4),this.ctx.fillRect(this.player.x+9,this.player.y+12,3,4)),this.ctx.restore(),this.player.isAttacking){this.ctx.fillStyle="#C0C0C0";const t=24;let h=this.player.x+8,i=this.player.y+8;const s=this.player.attackTimer/this.player.attackDuration,l=Math.sin(s*Math.PI)*6;switch(this.player.direction){case"up":this.ctx.fillRect(h-1,i-t+l,3,t);break;case"down":this.ctx.fillRect(h-1,i+16-l,3,t);break;case"left":this.ctx.fillRect(h-t+l,i-1,t,3);break;case"right":this.ctx.fillRect(h+16-l,i-1,t,3);break}this.ctx.fillStyle="#8B4513",this.ctx.fillRect(h-2,i-2,5,5)}}renderUI(){this.ctx.fillStyle="#FFFFFF",this.ctx.font='14px "Press Start 2P", monospace',this.ctx.fillText(`LEVEL ${this.currentLevel}`,20,25),this.ctx.fillStyle="#FFFFFF",this.ctx.font='10px "Press Start 2P", monospace',this.ctx.fillText("LIFE",20,45);for(let t=0;t<this.player.maxHealth;t++)this.ctx.fillStyle=t<this.player.health?"#FF0000":"#333333",this.ctx.fillRect(70+t*18,35,14,14);const e=this.levelObjectives[this.currentLevel];this.ctx.fillStyle="#FFFF00",this.ctx.font='8px "Press Start 2P", monospace',this.ctx.fillText(`ENEMIES: ${this.enemiesDefeated}/${e.enemies}`,20,65),this.ctx.fillText(`RUPEES: ${this.rupeesCollected}/${e.rupees}`,20,80),this.ctx.fillStyle="#AAAAAA",this.ctx.font="6px monospace",this.ctx.fillText("ARROWS: MOVE | z: ATTACK",20,this.height-10),(this.keys.z||this.keys.KeyZ)&&(this.ctx.fillStyle="#FFFF00",this.ctx.fillText("Z PRESSED!",200,this.height-10))}renderLevelComplete(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#00FF00",this.ctx.font='20px "Press Start 2P", monospace',this.ctx.textAlign="center",this.ctx.fillText(`LEVEL ${this.currentLevel}`,this.width/2,this.height/2-60),this.ctx.fillText("COMPLETE!",this.width/2,this.height/2-30),this.ctx.fillStyle="#FFFFFF",this.ctx.font='10px "Press Start 2P", monospace',this.ctx.fillText(`Enemies Defeated: ${this.enemiesDefeated}`,this.width/2,this.height/2),this.ctx.fillText(`Rupees Collected: ${this.rupeesCollected}`,this.width/2,this.height/2+20),this.currentLevel<this.maxLevel?(this.ctx.fillStyle="#FFFF00",this.ctx.fillText("Press SPACE for Next Level",this.width/2,this.height/2+50)):(this.ctx.fillStyle="#FFFF00",this.ctx.fillText("Final Level Complete!",this.width/2,this.height/2+50),this.ctx.fillText("Press SPACE to Continue",this.width/2,this.height/2+70)),this.ctx.textAlign="left"}renderGameWon(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#FFD700",this.ctx.font='24px "Press Start 2P", monospace',this.ctx.textAlign="center",this.ctx.fillText("VICTORY!",this.width/2,this.height/2-40),this.ctx.fillStyle="#FFFFFF",this.ctx.font='12px "Press Start 2P", monospace',this.ctx.fillText("You completed all levels!",this.width/2,this.height/2),this.ctx.fillText(`Total Rupees: ${this.player.rupees}`,this.width/2,this.height/2+20),this.ctx.fillStyle="#FFFF00",this.ctx.font='10px "Press Start 2P", monospace',this.ctx.fillText("Press R to Play Again",this.width/2,this.height/2+50),this.ctx.textAlign="left"}renderGameOver(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#FF0000",this.ctx.font='24px "Press Start 2P", monospace',this.ctx.textAlign="center",this.ctx.fillText("GAME OVER",this.width/2,this.height/2-40),this.ctx.fillStyle="#FFFFFF",this.ctx.font='12px "Press Start 2P", monospace',this.ctx.fillText(`Reached Level: ${this.currentLevel}`,this.width/2,this.height/2),this.ctx.fillText(`Final Score: ${this.player.rupees} Rupees`,this.width/2,this.height/2+20),this.ctx.fillStyle="#FFFF00",this.ctx.font='10px "Press Start 2P", monospace',this.ctx.fillText("Press R to Restart",this.width/2,this.height/2+50),this.ctx.textAlign="left"}restart(){this.currentLevel=1,this.enemiesDefeated=0,this.rupeesCollected=0,this.gameState="playing",this.player={x:256,y:224,width:16,height:16,speed:120,direction:"down",health:6,maxHealth:6,rupees:0,isMoving:!1,animFrame:0,animTimer:0,isAttacking:!1,attackTimer:0,attackDuration:.3,attackCooldown:0,invulnerable:!1,invulnerabilityTimer:0},this.entities=[],this.world=this.generateWorld(),this.generateLevel(),console.log("Game restarted!"),console.log(`Level ${this.currentLevel} started!`),console.log(`Objective: ${this.levelObjectives[this.currentLevel].description}`)}start(){const e=t=>{const h=Math.min((t-(this.lastTime||0))/1e3,.016);this.lastTime=t,this.update(h),this.render(),requestAnimationFrame(e)};requestAnimationFrame(e)}}const c=document.getElementById("gameCanvas"),n=c.getContext("2d");n.imageSmoothingEnabled=!1;n.webkitImageSmoothingEnabled=!1;n.mozImageSmoothingEnabled=!1;n.msImageSmoothingEnabled=!1;const d=2;c.style.width=c.width*d+"px";c.style.height=c.height*d+"px";const u=new y(c,n);u.start();console.log("Enhanced Zelda game with real gameplay started!");console.log("Complete objectives to advance through 5 challenging levels!");
